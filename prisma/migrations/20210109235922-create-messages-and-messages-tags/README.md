# Migration `20210109235922-create-messages-and-messages-tags`

This migration has been generated by DestroyeerU at 1/9/2021, 11:59:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."Message" (
"content" TEXT NOT NULL  ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"receiverId" INTEGER NOT NULL  ,"senderId" INTEGER NOT NULL  ,"subject" TEXT NOT NULL  ,FOREIGN KEY ("senderId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("receiverId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."MessageTags" (
"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"messageId" INTEGER NOT NULL  ,"tagId" INTEGER NOT NULL  ,FOREIGN KEY ("tagId") REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("messageId") REFERENCES "Message"("id") ON DELETE CASCADE ON UPDATE CASCADE)

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210109225503-create-tags..20210109235922-create-messages-and-messages-tags
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 model User {
   id         Int    @id @default(autoincrement())
@@ -18,16 +18,19 @@
   roleId  Int
   colorId Int
+  userReserve UserReserve[]
+  reserve     Reserve[]
+
   friendUser1 Friend[] @relation("user1")
   friendUser2 Friend[] @relation("user2")
   friendRequestSender   FriendRequest[] @relation("sender")
   friendRequestReceiver FriendRequest[] @relation("receiver")
-  userReserve UserReserve[]
-  reserve     Reserve[]
+  messageUserSender   Message[] @relation("messageUserSender")
+  messageUserReceiver Message[] @relation("messageUserReceiver")
 }
 model Role {
   id   Int    @id @default(autoincrement())
@@ -122,5 +125,31 @@
 model Tag {
   id   Int    @id @default(autoincrement())
   name String @unique
+
+  MessageTags MessageTags[]
+}
+
+model Message {
+  id      Int    @id @default(autoincrement())
+  subject String
+  content String
+
+  sender   User @relation("messageUserSender", fields: [senderId], references: [id])
+  receiver User @relation("messageUserReceiver", fields: [receiverId], references: [id])
+
+  senderId   Int
+  receiverId Int
+
+  MessageTags MessageTags[]
+}
+
+model MessageTags {
+  id Int @id @default(autoincrement())
+
+  tag     Tag     @relation(fields: [tagId], references: [id])
+  message Message @relation(fields: [messageId], references: [id])
+
+  tagId     Int
+  messageId Int
 }
```


